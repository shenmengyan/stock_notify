<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>台股測試通知</title>
</head>
<body>
  <h2>📢 台股通知測試中...</h2>
  <p>這是測試版，每 5 分鐘會跳出一次通知，顯示台股最新資訊。</p>

<script>
async function fetchTAIEX() {
  const today = new Date().toISOString().split('T')[0];
  try {
    const res = await fetch(`https://api.finmindtrade.com/api/v4/data?dataset=TaiwanStockPrice&data_id=TAIEX&start_date=${today}`);
    const data = await res.json();
    if (data.data.length === 0) return;

    const open = parseFloat(data.data[0].open);
    const close = parseFloat(data.data[data.data.length - 1].close);
    const diff = close - open;
    const direction = diff >= 0 ? '上漲' : '下跌';
    const msg = `📈 台股目前：${close.toFixed(2)} 點\n今日${direction} ${Math.abs(diff).toFixed(2)} 點`;

    showNotification(msg);
  } catch (e) {
    showNotification('❌ 無法取得台股資料，請稍後再試');
  }
}

function showNotification(msg) {
  if (Notification.permission === 'granted') {
    new Notification(msg);
  } else if (Notification.permission !== 'denied') {
    Notification.requestPermission().then(permission => {
      if (permission === 'granted') {
        new Notification(msg);
      }
    });
  }
}

// 每 5 分鐘執行一次
fetchTAIEX();
setInterval(fetchTAIEX, 5 * 60 * 1000);
</script>
</body>
</html>
